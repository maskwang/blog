---
title: PHP CI框架的安装配置和简单使用
id: 105
categories:
  - Ci
  - 技术专栏
date: 2011-08-22 22:45:06
tags:
---

<div>

## _概述和基本配置参数_

### 配置<span style="font-family: Times New Roman;">CI:</span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">application/config/config.php:14</span>配置你的域名</span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">application/config/database.php:40</span>配置你数据库的相关参数</span>

### 配置基于<span style="font-family: Times New Roman;">htaccess</span>的重定向

<span style="font-family: Times New Roman; font-size: small;">RewriteEngine on </span>

<span style="font-family: Times New Roman; font-size: small;">RewriteCond $1 !^(index¥.php|images|robots¥.txt) </span>

<span style="font-family: Times New Roman; font-size: small;">RewriteRule ^(.*)$ /index.php/$1 [L] </span>

<span style="font-size: small;">任何除开 <span style="font-family: Times New Roman;">index.php</span>，<span style="font-family: Times New Roman;">images</span>， 和<span style="font-family: Times New Roman;">robots.txt </span>的 <span style="font-family: Times New Roman;">HTTP </span>请求都当成对 <span style="font-family: Times New Roman;">index.php </span>文件的请求。</span>

### 增加 <span style="font-family: Times New Roman;">URL </span>后 缀

<span style="font-size: small;"><span style="font-family: Times New Roman;">application/config/config.php:57 </span>配置<span style="font-family: Times NewRoman;">$config['url_suffix'] = ".html"; </span></span>

<span style="font-size: small;">配置后带或不带后缀都可以访问</span>

### 使用<span style="font-family: Times New Roman;">index.php</span>的<span style="font-family: Times NewRoman;">get</span>方式访问控制类

<span style="font-size: small;"><span style="font-family: Times New Roman;">application/config/config.php</span>中<span style="font-family: Times New Roman;">: </span></span>

<span style="font-family: Times New Roman; font-size: small;">$config['enable_query_strings'] = true;
$config['controller_trigger'] = 'c';
$config['function_trigger'] = 'm'; </span>

<span style="font-size: small;">访问方式<span style="font-family: Times NewRoman;">:index.php?c=controller&amp;m=method </span></span>

### 自定义的简单的控制类

<span style="font-family: Times New Roman; font-size: small;">&lt;?php </span>

<span style="font-family: Times New Roman; font-size: small;">class Blog extends Controller { </span>

&nbsp;

<span style="font-family: Times New Roman; font-size: small;">              function index() </span>

<span style="font-family: Times New Roman; font-size: small;">              { </span>

<span style="font-family: Times New Roman; font-size: small;">                            echo 'Hello World!'; </span>

<span style="font-family: Times New Roman; font-size: small;">              } </span>

<span style="font-family: Times New Roman; font-size: small;">} </span>

<span style="font-family: Times New Roman; font-size: small;">?&gt; </span>

### 控制器的访问和参数传递

<span style="font-family: TimesNew Roman; font-size: small;">www.your-site.com/classname/functionname/para1/para2 </span>

<span style="font-family: Times New Roman; font-size: small;">www.your-site.com/classname/functionname/para1/para2.html </span>

### 定义默认控制器

<span style="font-size: small;"><span style="font-family: Times New Roman;">application/config/routes.php </span>中配置 <span style="font-family: Times NewRoman;">$route['default_controller'] = 'classname'; </span></span>

### 控制器中的预定义方法

<span style="font-size: small;"><span style="font-family: Times New Roman;">_remap() </span>方法<span style="font-family: Times New Roman;">:</span>不管<span style="font-family: Times New Roman;">uri</span>中调用的 方法是哪个<span style="font-family: Times New Roman;">,</span>该请求都会被重定向到此方法</span>

<span style="font-size: small;">被覆盖的方法名会作为参数传递进来<span style="font-family: Times New Roman;">,</span>参数依次排列到后面</span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">_output() </span>方法<span style="font-family: Times New Roman;">:</span>类中任意函数的输出结果都会交给此函数处理后再交给客户浏览器</span>

<span style="font-family: Times New Roman; font-size: small;">Function _output($output){echo $output}; </span>

### 视图

<span style="font-size: small;">在控制器中加载特定视图<span style="font-family: Times NewRoman;">:$this-&gt;load-&gt;view('_name_'); </span></span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">_name_ </span>是视图文件的文件名，不包括<span style="font-family: Times New Roman;">.php </span>后缀。</span>

<span style="font-family: Times New Roman; font-size: small;">$this-&gt;load-&gt;view('folder_name/_file_name_'); </span>

<span style="font-size: small;">向视图中传递动态数据<span style="font-family: Times NewRoman;">: </span></span>

<span style="font-family: Times New Roman; font-size: small;">$this-&gt;load-&gt;view('blogview', _$data,$data2_); </span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">$data</span>可以是数组或者对象<span style="font-family: Times New Roman;">(</span>类的示例<span style="font-family: Times New Roman;">); </span></span>

<span style="font-size: small;">视图中使用<span style="font-family: Times New Roman;">PHP</span>语法</span>

### 模型

<span style="font-size: small;">引入<span style="font-family: Times New Roman;">Model:$this-&gt;load-&gt;model('_Model_name_'); </span></span>

<span style="font-size: small;">一旦引入<span style="font-family: Times New Roman;">:</span>可以使用里面的函数<span style="font-family: Times New Roman;">:$this-&gt;_Model_name_-&gt;function(); </span></span>

<span style="font-size: small;">还可以指定<span style="font-family: Times New Roman;">model</span>名<span style="font-family: Times New Roman;">: </span></span>

<span style="font-family: Times New Roman; font-size: small;">$this-&gt;load-&gt;model('_Model_name_', 'fubar');

$this-&gt;fubar-&gt;function(); </span>

<span style="font-size: small;">模型被加载后不会自动建立数据库连接<span style="font-family: TimesNew Roman;">,</span>只会在被调用的时候才会</span>

<span style="font-size: small;">要在引入模型时建立数据库连接<span style="font-family: TimesNew Roman;">,</span>需要<span style="font-family: Times New Roman;">$this-&gt;load-&gt;model('_Model_name_', '', TRUE); </span></span>

### 助手

<span style="font-size: small;">助手包含完成特定功能的一系列函数<span style="font-family: TimesNew Roman;">,</span>导入特定助手后即可以像使用<span style="font-family: Times New Roman;">php</span>内置函数一样使用<span style="font-family: Times New Roman;">CI</span>助手提供的函数了</span>

<span style="font-family: Times New Roman; font-size: small;">$this-&gt;load-&gt;helper('_name_'); </span>

<span style="font-size: small;">加载多个助手<span style="font-family: Times New Roman;">:$this-&gt;load-&gt;helper( array('_helper1_', '_helper2_', '_helper3_') ); </span></span>

<span style="font-size: small;">自动加载某个助手<span style="font-family: Times NewRoman;">:</span>配置_<span style="font-family: Times New Roman;">application/config/autoload.php</span>__文件<span style="font-family: Times New Roman;">,</span>_把要加载的插件加入到自动加载的数组里<span style="font-family: Times New Roman;">(autoload array)</span>。</span>

### 插件

<span style="font-size: small;">与<span style="font-family: Times New Roman;">helper</span>类似<span style="font-family: Times New Roman;">,</span>但插件只提供单一的功能<span style="font-family: Times New Roman;">,</span>而<span style="font-family: Times New Roman;">helper</span>提供一系列的功能</span>

<span style="font-family: Times New Roman; font-size: small;">$this-&gt;load-&gt;plugin('_name_'); </span>

<span style="font-size: small;">比如<span style="font-family: Times New Roman;">$this-&gt;load-&gt;plugin('_captcha_');</span>加载的就是<span style="font-family: Times New Roman;">_captcha_pi.php_ </span></span>

<span style="font-family: Times New Roman; font-size: small;">$this-&gt;load-&gt;plugin( array('_plugin1_', '_plugin2_', '_plugin3_') ); </span>

<span style="font-size: small;">自动加载<span style="font-family: Times New Roman;">:_application/config/autoload.php_ </span></span>

### <span style="font-family: Times New Roman;">CI</span>库

<span style="font-size: small;">加载库<span style="font-family: Times New Roman;">:$this-&gt;load-&gt;library('_class name_'); </span></span>

<span style="font-size: small;">创建自己的库<span style="font-family: Times New Roman;">,</span>要求<span style="font-family: Times New Roman;">,</span>首字母大写<span style="font-family: Times New Roman;">, </span></span>

<span style="font-size: small;">自定义库中引用<span style="font-family: Times NewRoman;">CI</span>资源<span style="font-family: TimesNew Roman;">:get_instance() </span>函数</span>

<span style="font-family: Times New Roman; font-size: small;">$CI =&amp; get_instance();

$CI-&gt;load-&gt;helper('url');
$CI-&gt;load-&gt;library('session');
$CI-&gt;config-&gt;item('base_url'); </span>

### 使用<span style="font-family: Times New Roman;">CI</span>管理 数据库

<span style="font-family: Times New Roman; font-size: small;">application/config/routes.php:$route['scaffolding_trigger'] = "zhougege"; </span>

<span style="font-size: small;">在你的控制器的构造函数中添加<span style="font-family: TimesNew Roman;">:$this-&gt;load-&gt;scaffolding('marry_user_profile'); </span></span>

<span style="font-size: small;">就可以通过访问<span style="font-family: Times NewRoman;">http://localhost/yourclass/zhougege</span>来 管理你的数据库了</span>

### <span style="font-family: Times New Roman;">CI</span>错误处理

<span style="font-size: small;"><span style="font-family: Times New Roman;">Index.php</span>中默认的是显示所有错误<span style="font-family: Times New Roman;">:              error_reporting(E_ALL); </span></span>

&nbsp;

<span style="font-size: small;"><span style="font-family: Times New Roman;">show_error('message')</span>函数<span style="font-family: Times New Roman;">,</span>按<span style="font-family: Times New Roman;">application/errors/error_general.php</span>作为模板显示错误信息</span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">show_404('page')</span>函数<span style="font-family: Times New Roman;">,</span>按<span style="font-family: Times New Roman;">application/errors/error_404.php</span>作为模板显示一个<span style="font-family: Times New Roman;">404</span>错误</span>

<span style="font-size: small;"><span style="font-family: Times New Roman;">log_message('level', 'message')</span>函数<span style="font-family: TimesNew Roman;">,</span>把错误信息写入错误日志。你必须在第一个参数中提供错误级别<span style="font-family: Times New Roman;">(</span>三种<span style="font-family: Times New Roman;">)</span>，指出是哪种级别的错误<span style="font-family: Times New Roman;">(debug, error, info)</span>， 第二个参数是错误信息</span>

<span style="font-size: small;">**注意：**为了生成错误日志文件，必须在 <span style="font-family: Times New Roman;">application/config/config.php </span>文件中打开 <span style="font-family: Times NewRoman;">"log_errors" </span>选项，并保证 <span style="font-family: Times New Roman;">"logs" </span>文件夹可写。另外，你可以 为日志设置 <span style="font-family: Times New Roman;">"threshold"</span>。比如，你可以记录错误信息<span style="font-family: Times New Roman;">(Error Messages)</span>，但不记录其它两种类型。</span>

### <span style="font-family: Times New Roman;">CI</span>缓存<span style="font-family: Times New Roman;">:</span>

<span style="font-size: small;">在控制器中打开缓存<span style="font-family: Times NewRoman;">:$this-&gt;output-&gt;cache(_n_); _n_</span>是缓存时间，单位是**秒**。</span></div>