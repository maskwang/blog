---
title: 简单的自动压缩静态资源脚本
id: 709
categories:
  - Linux
  - 技术专栏
date: 2013-08-08 09:07:17
tags:
---

作用: 对静态资源进行自动压缩，并生成版本号
1\. 下载yui-compressor
<!--more-->
2\. 脚本
[code lang="shell"]
#!/bin/bash
# author: maskwang
# email : mask.wang.cn@gmail.com
# date : 2013-8-8 09:02
TASK_DIR=/var/www/
SH_NAME=`basename $0`
SH_EXISTS=`ps -ef | grep $SH_NAME | grep -v grep | grep -v &quot;/bin/sh&quot; | wc -l`

if [ &quot;$SH_EXISTS&quot; -gt 2 ]; then
	echo &quot;[`date` shell is running...[$SH_EXISTS]]&quot;
        exit
fi

if [ ! -d $TASK_DIR ]; then
    mkdir $TASK_DIR
	echo &quot;[`date`] created &quot;$TASK_DIR
fi

echo &quot;[`date` start checking...]&quot;
while : ; do
	TASK_VERSION=`date '+%Y%m%d%H%M%S'`
	for i in `ls $TASK_DIR`
	do
		TEMP_DIR=$TASK_DIR$i
		for j in `ls $TEMP_DIR | grep .js`
		do
			FNAME=`basename $j`
			FILENAME=$TEMP_DIR&quot;/&quot;$FNAME
			TASK_VERSION_DIR=$TEMP_DIR&quot;/&quot;$TASK_VERSION
			if [ ! -d $TASK_VERSION_DIR ]; then
				mkdir $TASK_VERSION_DIR
                                # 主要这句
				`java -jar yuicompressor-2.4.2.jar $FILENAME -o $TASK_VERSION_DIR&quot;/&quot;$FNAME --charset utf-8`
				rm $FILENAME
			fi
		done
	done
	sleep 2
done
[/code]

3\. 把脚本加到crontab,搞定，欢迎拍砖